名前：Coinjoin
説明：Bitcoin 上での CoinJoin の理解と使用

![キャプション](assets/1.jpeg)

# Bitcoin 上での CoinJoin の理解と使用

## 導入

ピア・ツー・ピアの支払いシステムにおける初期の問題の 1 つは、二重支払いです。支払いネットワークを悪意のあるアクターが悪用し、同じアカウントのユニットを複数回支払うことを防ぐ方法はありませんか？中央機関の介入なしに。

Satoshi Nakamoto は、彼の Bitcoin プロトコルでこの問題を解決しました。中央機関の介入なしに動作するピア・ツー・ピアの電子支払いネットワークです。彼のホワイトペーパーでは、トランザクションの不在を確認し、したがって二重支払いの試みがないことを確認する唯一の方法は、分散型支払いネットワーク上で行われたすべてのトランザクションについて知ることです。

各ユーザーがトランザクションについて通知されるためには、トランザクションを公開する必要があります。Bitcoin プロトコルによって提案されたピア・ツー・ピアの支払いシステムは、完全に透明で分散したインフラストラクチャによって可能にされました。したがって、ノードを持つ誰でも、電子署名チェーンと各コインの履歴を、マイナーによって作成された時点から確認することができます。

> この台帳の分散と新しいトランザクションの公開の原則は、最新の暗号通貨（ビットコイン）で使用されていますが、1998 年に Wei Dai によって発明された b-money など、以前の暗号通貨でも使用されていました。
>
> この透明性と分散性により、Bitcoin ネットワークの各ユーザーは他のすべてのユーザーのトランザクションを追跡および観察することができます。したがって、支払いのレベルではプライバシーは不可能です。代わりに、それは個人の識別のレベルで行われます。

従来の銀行システムとは異なり、ビットコインでは各ユニットをアイデンティティ（名前、名字など）に関連付けるのではなく、鍵のペアに関連付けます。したがって、ユーザーは暗号的な識別子によって匿名で表されます。

したがって、Bitcoin 上でのプライバシーの喪失は、観察者が特定の UTXO と特定のユーザーの間にリンクを作成できる場合に発生します。ユーザーとその支払いの履歴を追跡および分析することができます。

CoinJoin は、Bitcoin のユーザーに一定のプライバシーレベルをもたらすために、UTXO の履歴を破壊する方法です。
この記事では、CoinJoin とは何か、その動作方法、そして正しい使い方について一緒に学んでいきます。私の考えでは、CoinJoin の実装である Whirlpool が現在最も効果的なものですが、他の既存の実装についても触れます。また、ビットコインの機密性レベルを正確に計算するための指標についても説明します。理論だけで終わらず、さまざまな方法で CoinJoin トランザクションを実際に行う方法も具体的に紹介します。最後に、CoinJoin の一連の手順の後に得られた機密性を失わないために注意すべきベストプラクティスを学び、これを可能にする Samourai Wallet のさまざまなツールを紹介します。

この記事が気に入った場合は、ソーシャルメディアや知人と共有してください。

> 目次:
>
> - CoinJoin とビットコインのミキシング
> - CoinJoin のさまざまな実装
> - Whirlpool の理論的な動作
> - チュートリアル: Sparrow Wallet での Whirlpool
> - チュートリアル: Dojo と Whirlpool GUI での Whirpool CLI
> - ポストミックスのベストプラクティス
> - 支出ツール
> - ビットコインのミキシングは悪いことですか？

ビットコインの初心者の方は、この記事を読む前に、ビットコインのトランザクションの構造（UTXO、inputs、outputs）を理解するために、このトピックに関する短い記事を読むことを強くお勧めします。

> CoinJoin の使用は、ユーザーに間接的なリスクをもたらす可能性があります。一部のサービスプロバイダーは、あなたの行動に応じて資金やアカウントをブロックし、その資金の出所についての正当性を要求する可能性があります。この記事に含まれる情報は、システムやソフトウェアに関するアドバイスではなく、CoinJoin を実行するためのいかなる誘因も提供しません。CoinJoin を実行するには、インターネットに接続されたソフトウェアウォレット（「ホットウォレット」とも呼ばれる）を使用する必要があります。資金が失われたり盗まれたりする可能性があります。さまざまなリスクについて自分で調査することをお勧めします。この記事は、これらのトピックに関する唯一の情報源としては使用できません。

## CoinJoin とビットコインのミキシング

始める前に、CoinJoin とミキシングの違いを理解することが重要です。

ミキシング（英語では「mixing」、「blender」または「tumbler」とも呼ばれる）は、UTXO（未使用トランザクション出力）を混ぜ合わせ、ビットコインを混ぜ合わせ、その履歴を切り離し、トレースを困難にする技術です。この操作の目的は、ユーザーの機密性を向上させるために UTXO を匿名化することです。匿名化は、UTXO が他の複数の区別できない UTXO のグループ内に存在する場合に発生します。
ミキシングと CoinJoin は、元々同じ目的を持つ 2 つの技術ですが、異なる方法で機能します。ミキシングは、ビットコインをミキシングするために信頼できる第三者にビットコインを預けることに基づいていますが、CoinJoin はユーザーのアクションを同期するためのコーディネーターにのみ依存しており、資金を操作することはありません。

CoinJoin の登場により、ミキシングはすぐに時代遅れになり、ユーザーはそれを避けるようになりました。ChipMixer など、まだいくつかのミキシングサービスは存在しますが、今日では CoinJoin がますます多くの個人によって使用されています。

その結果、ビットコインユーザーの一般的な言葉では、多くの人々が最終的に CoinJoin を指すために「ミキシング」という言葉を使用しています。このセマンティクスは元々間違っているものの、ユーザーの間では一般的に受け入れられています。そのため、CoinJoin トランザクションから出力された UTXO を指すために「ミキシングされたビットコイン」という言葉が使われます。

CoinJoin は、UTXO の履歴を分断するための技術です。これは、CoinJoin トランザクションという特定の構造を持つ協力的なトランザクションに基づいています。このトランザクションのタイプは、Gregory Maxwell が 2013 年に Bitcoin Talk フォーラムで最初に提案しました。

一般的な動作は次のとおりです。ミキシングを希望するさまざまなユーザーが、トランザクションの入力として金額を預けます。これらの入力は、同じ金額の異なる出力として出力されます（おつりがある場合もありますが、後で詳しく説明します）。トランザクションの出力では、どの出力がどのユーザーに属しているかを特定することは不可能です。CoinJoin トランザクションの入力と出力の間には、技術的には何の関連もありません。各ユーザーと各 UTXO の間の関連性は断たれ、各コインの履歴と同様になります。

各ユーザーがいつでも自分の資金を失わずに CoinJoin を行うために、トランザクションはまずコーディネーターによって構築され、それから各ユーザーに送信されます。各ユーザーは、トランザクションが自分に適しているかを確認しながら、それぞれがトランザクションに署名します。その後、すべての署名がトランザクションに追加されます。もしユーザーまたはコーディネーターが CoinJoin トランザクションの出力を変更して他の人々の資金を盗もうとした場合、署名は無効となり、ノードによってトランザクションは拒否されます。

類推を許していただければ、CoinJoin はヘリコプターと車の追跡レースのようなものと考えることができます。白い車を追いかけるヘリコプターを想像してみましょう。ヘリコプターは、あなたの支払いを分析しようとする人を表し、白い車はあなたの UTXO を表します。ヘリコプターは車の上空を飛ぶことで簡単に車を追いかけることができます。
今、追跡されている車に近くを走る他の 4 台の同じ白い車があると想像しましょう。ヘリコプターは最初に追っていた白い車をまだ追い続けることができます。
さて、これらの 5 台の車がトンネルを通過し、ヘリコプターが一時的に車を見ることができなくなったと想像してみましょう。トンネルを出た時点で、ヘリコプターは最初に追っていた車がどれかわからなくなります。この例では、トンネルは CoinJoin のような役割を果たします。CoinJoin トランザクションの出力 UTXO は、他の UTXO のグループの中に隠されます。潜在的な観察者は、あなたの UTXO がこのグループにあることを知ることができますが、それがどれかは確定できません。

CoinJoin のユーザーにとっての技術的な目標は、できるだけ大きな「匿名性セット」を所有することです。この概念は、後の理解のために非常に重要です。「匿名性セット」または「Anon Sets」とも呼ばれるものは、特定の UTXO の匿名性レベルを計算するためのパラメータを指します。2 つのパラメータがあります：予測スコアと後方スコア。

予測スコアは、所有している UTXO が隠れている UTXO グループのサイズを示します。例えば、4 人の他のユーザーと CoinJoin を行った場合、CoinJoin トランザクションの直後の予測スコアは 5 になります。

ヘリコプターの例を再び考えてみましょう。トンネルを出た時点で、各白い車は予測スコアが 5 になります。ヘリコプターは、その 5 台の車のグループの中にターゲットがいることを知っていますが、最初のターゲット車がどれかは区別できません。

これら 2 つのパラメータがどのような意味を持つかについては、この部分で詳しく説明します。ただし、現時点では、ミックスされた UTXO の Anon Sets が大きいほど、観察者による追跡が困難になることを覚えておいてください。

# CoinJoin の異なる実装方法

CoinJoin トランザクションは、直接他の Bitcoin ユーザーと手動で行うこともできます。しかし、この方法は非常に手間がかかり、効率があまりよくありません。効果的で迅速にネットワーク全体でスケーリングするためには、世界中のどのユーザーとでも合意する必要があります。そのため、トランザクションのモデルを開発し、異なるユーザーを結び付け、トランザクションの共同実行を可能にする情報を伝える役割を持つコーディネーターのサービスを使用します。

Bitcoin 上での CoinJoin の主な実装方法は次の 3 つです：

> JoinMarket.
>
> Wasabi.
>
> Whirlpool.
> これら 3 つの実装の最終目標は、CoinJoin トランザクションを使用して UTXO の履歴を破壊することですが、それぞれの動作は非常に異なります。したがって、それぞれの仕組みを理解して、自分の期待に最も適した実装を選ぶために情報を収集する必要があります。
> 私の Twitter をフォローしている方ならお分かりかと思いますが、個人的には Whirlpool の実装を使用することを好んでいます。そのため、他の 2 つのソリューションの理論的な動作を簡単に説明し、なぜそれらが適していないと考えるのか詳しく説明します。そして、CoinJoin の実装である Samourai Wallet チームによって開発された Whirlpool の動作について詳しく調査します。私にとっては、現在最も優れた CoinJoin ソリューションです。

各実装に関する特徴は現在有効ですが、この記事を読んでいる時点で変更されている可能性があります。

![Caption](assets/2.jpeg)

## JoinMarket

JoinMarket は、ユーザー間のマッチングモデルによって他の主要な実装とは明確に異なります。実際、ユーザー間の流動性を提供するユーザーと、ユーザーが流動性を提供するために使用するユーザーとの間の取引市場に基づいています。

JoinMarket で CoinJoin を実行する場合、他のユーザーが報酬を受け取るために自分のビットコインを使用できるようにするか、他のユーザーの流動性を使用して直接報酬を支払って CoinJoin を実行するかを選択する必要があります。つまり、ビットコインを提供する「メーカー」と、流動性を使用する「テイカー」が存在します。テイカーはメーカーに対して報酬を支払います。

したがって、使用条件のない完全に自由な市場と言えます。

このサービスの主な欠点は、非常に使いこなすのが難しいことです。Linux のコマンドラインに関する最低限の知識が必要です。この実装は比較的効果的ですが、一般のユーザーには明らかに適していません。

CoinJoin トランザクションに関連する機能については、JoinMarket は Whirlpool に比べていくつかの弱点があります。たとえば、使用される CoinJoin トランザクションの構造により、入力と出力の間に確定的なリンクが 0％存在しないことがあります。また、JoinMarket には、過去にすでに出会ったコイン間で新しい CoinJoin を防ぐためのツールが含まれていないことにも注意することができます。

ユーザーに提供される追加サービスに関しては、JoinMarket には UTXO の Anon Sets を簡単に計算するためのツールが含まれていません。また、ミックスされた UTXO の支出ツールに関しては、実装には PayJoin のみが提供されています。
最終的に、JoinMarket は興味深い CoinJoin の実装ですが、誰にでも適しているわけではありません。コマンドラインに慣れていて、CoinJoin の動作をよく理解しており、"takers" / "makers"モデルが好きな場合、この実装は適しています。

## Wasabi 2.0.

Wasabi の CoinJoin サービスは、理論的には Whirlpool と同様に機能します。JoinMarket とは異なり、Wasabi はサービスのすべてのユーザーのビットコインを自動的にミックスする調整者として機能します。

しかし、CoinJoin トランザクションの構造自体は Whirlpool とは大きく異なります。次のセクションで見るように、Whirlpool でミックスされた UTXO の見込みスコア（Anon Set）は、毎回少数のユーザーと複数の CoinJoin の蓄積によって増加します。一方、Wasabi でミックスされた UTXO の Anon Set は、多数のユーザーを対象とした少数のトランザクションで行われます。

Wasabi 1.0 で可能性のある Coinjoin の例：
https://kycp.org/#/b994a9cbdc20e971207bde4f800b9ce99dba35478a2a997bc48e7f9f80bd2d02

Whirlpool で行われた Coinjoin の例：https://kycp.org/#/323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2

両実装は、おつりの処理方法も異なります。Whirlpool では、CoinJoin の前におつりは UTXO から分離されます（次のセクションで説明します）。Wasabi では、おつりは CoinJoin トランザクションのアウトプットです。Wasabi でのこの CoinJoin の構造の選択により、入力と一部のアウトプットの間に決定論的なリンクが残ります。

バージョン 2.0 では、Wasabi は CoinJoin の手数料ポリシーを完全に変更しました。調整者の手数料は、0.01 ビットコインを超える UTXO に対しては 0.3％になり、この金額以下の UTXO に対しては無料です。小さな UTXO も無料でリミックスされます。なお、調整者の手数料が無料であっても、ユーザーはすべてのトランザクション、リミックスのトランザクションも含めてマイニング手数料を支払う必要があります。
したがって、Whirlpool とは異なり、Wasabi で UTXO をミックスするために大量の Anon セットを持ちたい場合、より多くの手数料を支払う必要があります。これは Wasabi のバージョン 1.0 とバージョン 2.0 の両方に当てはまります。最新バージョンでは小さな UTXO に対してはコーディネーター手数料が免除されますが、マイニング手数料は残ります。さらに、バージョン 2.0 を使用していると、Wasabi での最大の見込みスコアは 300 であるという印象を受けました。一方、Whirlpool では数ヶ月で 5 桁の見込みスコアに簡単に到達でき、このスコアに制限はありません。

CoinJoin の構造自体に加えて、Wasabi には CoinJoin に補完するツールが非常に不足していると思います。特に、ミックスされた UTXO を適切に使うためのツールが必要です。バージョン 1.0 では支出ツールがありません。バージョン 2.0 では、ミックスされた UTXO の入力と出力を自動的に調整し、おつりを削除してプライバシーを最大化する UTXO 支出ツールが含まれています。この機能は便利かもしれませんが、Whirlpool でミックスされた UTXO を適切に使うために提供される多数のツールと比べると、効果的で使いやすいとは言えません。これらのツールについては、記事の後半で詳しく説明します。

Whirlpool とは異なり、Wasabi はミックスされた UTXO、ミックスされていない UTXO、おつりの UTXO をアカウントごとに分けません。このウォレットの構造により、ミックスされた UTXO と他の UTXO の間でアドレスの再利用が可能になります。これが発生すると、CoinJoin が完全に破壊される可能性があります。

最終的に、バージョン 2.0 を試した結果、Wasabi を使用すると CoinJoin を完全に制御できないという印象を強く受けました。すべてが簡素化され、自動化されており、ユーザーインターフェースも美しいですが、CoinJoin の実装に期待されるものでしょうか？

## Whirlpool の理論的な動作

他の実装とは異なり、Whirlpool は「ZeroLink」と呼ばれる CoinJoin トランザクションの構築によって、すべての入力と出力の間に技術的なリンクが一切存在しないようにしています。

これは、各ユーザーが同じ金額を入力として預け、同じ金額の出力として出てくる CoinJoin トランザクションによって実現されます。

このような制約のある入力構造により、Whirlpool の CoinJoin トランザクションは、ユーザーが入力と出力の間に確定的なリンクが 0％存在しない唯一のトランザクションです。つまり、各出力は他のトランザクションの出力と同じ確率でユーザーに属している可能性があります。
各ミックスの参加者数は 5 人に制限されています：2 人のエントリー参加者と 3 人のリミキサー（後でその内容を説明します）。したがって、Whirlpool 上の CoinJoin トランザクションは常に 5 つのエントリーと 5 つの出力を持っています。
![WhirlpoolのCoinJoinトランザクションの図式表現。](assets/3.jpeg)

## Whirlpool の設計

Whirlpool による提案モデルは、非常に小さなトランザクションに基づいています。Wasabi や JoinMarket とは異なり、Anon Sets の強さは CoinJoin に参加するユーザーの数ではなく、毎回 5 人の参加者による複数の小さな CoinJoin の連続によって得られます。

ユーザーはプールに入る際に一度だけ支払い、その後は自由にリミックスすることができます。新規参加者がリミキサーのマイニング手数料を支払います。

ユーザーと出会った仲間のリミックスによって、Anon Sets は指数関数的に増加していきます。したがって、UTXO の Anon Sets に深みを加えるために、これらの無料のリミックスを最大限に活用することが目標です。

Whirlpool は 2 つの主要な基準に基づいて考案されました：

- 実装がモバイルで使用可能であること。

- リミックスのサイクルが迅速に行われること。

これらの 2 つの理由から、Samourai チームはサイクルごとのユーザー数を 5 人に制限することを選びました。より少ない数では効果的な CoinJoin が行えず、サイクルごとの Anon Sets が強く減少してしまいます。より多い数はモバイルクライアントでは扱いが難しく、サイクルのフローが減少してしまいます。

結局、Whirlpool の CoinJoin ごとに多くの参加者が必要ではないので、Anon Sets は複数のミキシングサイクルの蓄積によって形成されます。

## プールと手数料

これらの複数のサイクルによって UTXO の Anon Sets を増やすためには、使用される UTXO の金額を制限する必要があります。Whirlpool では、異なるプール（英語で「bassins」とも呼ばれる）が定義されています。

プールはミキシングを希望するユーザーのグループであり、CoinJoin の動作を最適化するために使用される UTXO の金額に合意しています。各プールは、ユーザーが参加するために適応する必要のある UTXO の固定金額を定義します。具体的には、CoinJoin を行いたい場合は、ミキシングを開始するために参加するプールを選択する必要があります。現在 Whirlpool で存在する異なるプールは次のとおりです：

- 0.5 ビットコイン
- 0.05 ビットコイン
- 0.01 ビットコイン
- 0.001 ビットコイン（= 100,000 sats）

したがって、誰でも自分に合ったプールを見つけることができます。

各プールには、参加するための最大金額があります：

| プール（ビットコイン） | エントリーごとの最大金額（ビットコイン） |
| ---------------------- | ---------------------------------------- | --- | ---- | --- |
| 0.5                    | 35                                       |     | 0.05 | 3.5 |
| 0.01                   | 0.7                                      |
| 0.001                  | 0.025                                    |

プールに参加するには手数料を支払う必要があります。これらの手数料は各プールごとに固定されており、Whirlpool を開発および管理するチームに支払われます。手数料はプールにアクセスする際にのみ一度だけ徴収されます。プールに参加した後は、自由にリミックスを行うことができます。

現在、各プールに適用されている手数料は次のとおりです：

| プール（ビットコイン） | 参加手数料（ビットコイン） |
| ---------------------- | -------------------------- |
| 0.5                    | 0.0175                     |
| 0.05                   | 0.00175                    |
| 0.01                   | 0.0005（50,000 sats）      |
| 0.001                  | 0.00005（5,000 sats）      |

Whirlpool でのミックスにかかる手数料は、次のサイトで簡単に計算することができます：https://www.whirlpoolfees.com/

また、これらの手数料はプールへの「入場券」です。つまり、0.01 btc でプール 0.01 に入る場合と、0.5 btc で入る場合でも、手数料はまったく同じです。したがって、ユーザーはミックスを行う前に、小さなプールでより少ない手数料を支払いたいか、より大きなプールを使用してより多くの手数料を支払いたいかを考える必要があります。小さなプールを使用する場合、複数の小さな UTXO で出てくることになります。

ミキシングサイクルの終了時には、ミキシングされた複数の UTXO を結合することは一般的に推奨されません。これにより、以前に厳しく獲得したプライバシーが崩れる可能性があります。したがって、より大きなプールを使用してより多くの手数料を支払い、より大きなサイズの UTXO で出てくることを選択することがあります。

考慮すべき他の手数料は、ビットコインのすべてのトランザクションに固有のマイニング手数料です。Whirlpool のユーザーとして、Tx0 のマイニング手数料と最初のミックスのマイニング手数料を支払う必要があります。その後のすべてのリミックスは新規参入者に基づいた Whirlpool の手数料モデルに基づいて無料です。

各 CoinJoin は 5 人のユーザーで構成されています。そのうち 2 人は参加者であり、3 人はリミックスです。したがって、各ミックスの 2 人の参加者は 5 人のユーザーのマイニング手数料を支払い、その後、これらの 2 人の参加者は次のリミックスの無料を利用することができます。

![legende](assets/4.jpeg)
Whirlpool は、ユーザーが支払った料金に比例しないため、他の CoinJoin サービスとは異なる特徴を持つ。そのため、ユーザーはプールの手数料と 2 つのトランザクション（Tx0 と初期のミックス）のマイニング手数料だけを支払った場合でも、非常に高い Anon Sets に到達することができる。もちろん、ユーザーは多くのリミックスを行った後に UTXO をプールから引き出す際にもマイニング手数料を支払う必要がある。

前述のように、UTXO がミックス可能な状態にある場合、それはプール内にあると言われる。これはユーザーが所有権を失うことを意味しない。Whirlpool のさまざまな CoinJoin を通じて、あなたは完全に自分の鍵とビットコインの主人であり続けます。

## Whirlpool のアカウント

このような CoinJoin トランザクションを実行するために、Whirlpool を使用するウォレットは複数のアカウントを派生させる必要があります。

アカウントは HD ウォレット内のサブセクションです。この分割は、ウォレットの深さ 3 で行われます。つまり、xpub/xprv のレベルで行われます。

HD ウォレット内のアカウントの概念に慣れていない場合は、こちらの専門書を無料でダウンロードすることをお勧めします。また、ビットコインウォレットの派生パスの動作についての記事も書いています。

Whirlpool を使用するためにこれらすべてを理解する必要はありませんが、アカウントは HD ウォレットのサブセクションであり、他のアカウントと完全に分離され、独自の xpub/zpub を持っていることを覚えておいてください。

これらの異なるアカウントの厳格な分離により、Whirlpool 上でミックスされたビットコインとミックスされていないビットコインの再利用が起こることはありません。

HD ウォレットごとに最大 2^(32/2)個の異なるアカウントを派生させることができます。最初のアカウントは、デフォルトで使用されるアカウント 0'です。

Whirlpool の使用に適したウォレットを使用する場合、自動的に 5 つのアカウントが作成されます。

    インデックス0'で決定されるデポジットアカウント。

    インデックス2 147 483 644'で決定されるBad Bank（doxxic change）アカウント。

    インデックス2 147 483 645'で決定されるPre Mixアカウント。

    インデックス2 147 483 646'で決定されるPost Mixアカウント。

    インデックス2 147 483 647'で決定されるRicochetアカウント：この最後のアカウントはWhirlpoolプロトコル内で直接使用されませんが、関連しています。支出ツールに関するセクションで詳しく説明します。

各アカウントはそれぞれ異なる目的を持ち、特定のタスクに destine されます。
すべてのアカウントは同じ seed に依存しています。したがって、ユーザーは復旧フレーズとオプションのパスフレーズに問題がある場合でも、すべての資金へのアクセスを簡単に回復することができます。ただし、使用されたアカウントの異なるインデックスを回復ソフトウェアに指示する必要があります。

それでは、これらのアカウント内での CoinJoin Whirlpool の異なるステップを見てみましょう。

## Tx0.

CoinJoin の開始時には、まずデポジットアカウントから始まります。これは、新しい Bitcoin ウォレットを作成する際にデフォルトで使用するアカウントです。このアカウントには、ユーザーがミキシングしたいビットコインを入金する必要があります。

Tx0 は、Whirlpool のミキシングプロセスの最初のトランザクションです。その目的は、ミキシングするための UTXO を最初のミックスに送る前に、ミキシングする UTXO（または複数）をクリーンアップすることです。このトランザクションでは、入力の UTXO を、選択したプールの金額に対応する複数の UTXO に分割します。これらの均等化された UTXO は、プレミックスアカウントに送信されます。選択したプールに入らない残りの差額は、それに専用のアカウントである Bad Bank（または "Doxxic Change"）に分離されます。

この Tx0 では、コーディネーターに手数料を支払うこともできます。

Tx0 のマイニング手数料を支払う必要があります。

![CoinJoin Bitcoin の Tx0 の図](assets/5.jpeg)

クレジット（画像の変更）：KYCP.org：https://kycp.org/#/a126e48d4a6eb8d19682ec0e23ad45e76cd52b45f6c17be5068ae051d4b2cc24

この Tx0 のトランザクションの例では、ユーザーのデポジットアカウントからの 2.2550 ビットコインの入力が表示されます。この入力は、次のものを表す複数の出力に分割されます。

- コーディネーターの手数料（ここでは 0.0250 B）。

- ユーザーのプレミックスアカウントに向かう 4 つのミキシング用の UTXO。これらの UTXO もコーディネーターに登録されます。

- プールに入らない残りの差額。これは、専用のアカウントに移動されるトキシックチェンジです。

ここでの手数料は、Samourai が 2021 年 3 月に Whirlpool の価格を引き下げたため、前の表とは異なります。

## Doxxic Change アカウント。

プールに入れないチェンジは、Doxxic Change アカウント（または "Bad Bank" とも呼ばれる）に送信され、他のアカウントから完全に分離されます。

この UTXO は、ユーザーのプライバシーに対して危険です。なぜなら、それは常に過去に関連付けられており、したがって所有者のアイデンティティに関連付けられている可能性があるからです。さらに、CoinJoin を行った所有者に帰属すると記録されています。
この UTXO がミックスされた UTXO と統合されると、以前に獲得した機密性は失われます。他の Doxxic Changes と統合されると、ユーザーの機密性が低下する可能性がありますので、注意が必要です。したがって、この有毒な UTXO をどのように処理するかを詳しく説明します。

## Pre Mix アカウント

Pre Mix アカウントには、Tx0 で均等化された UTXO があり、ミックスの準備ができています。これらの UTXO は、初期ミックスのマイニング手数料を支払うために、プールの金額よりもわずかに多くなります。

これらの UTXO が初期ミックスを経ていると、Pre Mix アカウントは空になり、次のアカウントに新しい UTXO が存在します。

## Post Mix アカウント

Post Mix アカウントには、初期ミックスから新しくミックスされた UTXO が含まれています。また、他のリミックスに使用可能な他のすべての UTXO も含まれています。

Whirlpool クライアントが実行中の場合、Post Mix アカウントにある UTXO はリミックスに使用できます。リミックスのためにランダムに選択されます。

ユーザーがミックスされた UTXO を使用する場合、Post Mix アカウントから直接使用することができます。また、ミックスされた UTXO をこのアカウントに残しておくことをお勧めします。これにより、無料でリミックスされるだけでなく、Whirlpool のサーキットから出ないようにすることもできます。そうしないと、機密性が低下する可能性があります。

## Anon Sets

前述のように、Anon Sets は UTXO の機密性を計算し、CoinJoin セッションの効果を評価するための 2 つのパラメータです。

最初のパラメータは、予測スコア（英語：「Forward-looking Anon Set」）です。このセマンティクスは間違っていますが、このスコアはしばしば「Anon Set」と略して呼ばれます。

UTXO の予測スコアは、その UTXO が特定の時点でどれだけのグループに隠されているかを表します。

イメージを示すために、予測スコアは、過去に与えられた UTXO に対応する可能性のある現在の UTXO の数です。例えば、CoinJoin プールに入る前に所有している UTXO を追跡するビットコインチェーンを監視しているアクターを想像してみましょう。コインが複数回ミックスされた後、観察者はそれがどこに行ったのかを知りたくなります。そのため、さまざまな可能な経路を追跡し、CoinJoin の性質により、所有している UTXO に対応する可能性のある複数の UTXO にたどり着くでしょう。これらの潜在的な UTXO の数が、あなたの UTXO の予測スコアです。

したがって、最初の Whirlpool CoinJoin の出力時に、UTXO の予測スコアは 5 になります。つまり、5 つの UTXO のグループに隠されていることを意味します。
![ビットコインUTXOの将来のスコア計算のスキーマ](assets/6.jpeg)
もし誰かが私の入力 UTXO を監視している場合、彼はこれら 5 つの出力 UTXO のうちどれが私のものかを知ることはできません。

この将来のスコアは、ユーザーのリミックスだけでなく、彼が以前のミックスで出会ったピアのリミックスによっても増加します。今回の例を振り返ってみましょう。現時点で将来のスコアが 5 の UTXO があります。この私たちの UTXO がリミックスされると、そのスコアは 9 になります。

Whirlpool の興味深い点は、私の UTXO がリミックスされなくても、他の UTXO と区別できないグループに属しているため、過去に出会ったピアのリミックスに応じてスコアが増加することです。

私たちの UTXO が最初のミックスを通過し、現在スコアが 5 であると仮定しましょう。同じミックスに存在する UTXO が新しいリミックスに移行すると、私の UTXO のスコアは 9 に増加しますが、それ自体は初期のミックス以来変化していません：

![ビットコインUTXOの将来のスコア計算のスキーマ](assets/7.jpeg)

この将来のスコアの増加は指数関数的です。つまり、最初のミックスで私が出会った UTXO によって出会った UTXO がリミックスされると、私の Anon Set はさらに増加します：

![ビットコインUTXOの将来のスコア計算のスキーマ](assets/8.jpeg)

この指数関数的な増加は、Whirlpool のユニークなモデルによって可能になります。このモデルは、多くの小さな連続した CoinJoin に基づいています。

再度言及しますが、これらのリミックスはすべて無料ですので、自分の UTXO をミックスし、リミックスすることは非常に賢明です。ただし、自分の UTXO を使う必要がない限り、過去に出会ったピアのリミックスを利用することができます。

![スタイリッシュなビデオ](assets/7-5.mp3)

UTXO のプライバシーレベルを計算するために特定の UTXO で決定できる 2 番目の Anon Set は、レトロスペクティブスコア（英語で"Backward-looking Anon Set"）です。

このレトロスペクティブスコアは、最初のミックスの前のピアが残してくれる遺産のようなものです。これは、ミックスされた UTXO に対応することができる Tx0 の数を示します。

したがって、最初に言及したトレースの試みに対抗する場合の UTXO のプライバシーレベルを判断することができます。

将来のスコアでは、CoinJoin サイクルの入力 UTXO から出力 UTXO へのトレースの試みに対してどれだけプライバシーがあるかを判断するパラメータです。レトロスペクティブスコアでは、サイクルの出力 UTXO を出発点としてトレースを行い、入力 UTXO がどれだけプライバシーがあるかを判断するパラメータです。つまり、逆の経路をたどります。
例えば、ビットコインのチェーンの観察者が UTXO を知っており、その UTXO の出所を追跡してその起源を特定しようとする場合を想像してみましょう。その観察者は、その UTXO が CoinJoin を経由したことを知り、潜在的に目的の UTXO となり得る多くの CoinJoin の入力 UTXO に出くわすでしょう。これらの潜在的な UTXO の数は、追跡された UTXO のリトロスペクティブスコアです。

このリトロスペクティブスコアを計算するには、まず、対象の UTXO から Tx0 からの入力 UTXO を数える必要があります。次に、トランザクションのリミキシングの入力 UTXO を分析し、それらが派生している 3 つの前の CoinJoin トランザクションまで遡ります。これらの 3 つのトランザクションそれぞれについて同じ計算を行います。このようにして、プールの最初の CoinJoin トランザクションである CoinJoin Genesis まで続けます。

上記の図に示されているように、上部の CoinJoin の出力 UTXO のリトロスペクティブスコアを計算することは、対象の CoinJoin までの上位の CoinJoin に存在する Tx0（青いバブル）の数を計算することになります。

UTXO のプロスペクティブスコアが初期のミックス後に 5 から始まり、増加するのに対して、UTXO のリトロスペクティブスコアは、初期のミックスを行った直後にすぐに非常に高くなります。UTXO が最近ミックスされた回数が多いほど、そのリトロスペクティブスコアは高くなります。選択したプールの前のミックスの遺産を受け継ぐことができます。

## Whirlpool Stats Tool (WST).

Whirlpool でミックスされた UTXO の Anon Sets を簡単に計算するために、Whirlpool Stats Tool (WST)を使用することができます。Whirlpool での Anon Sets を計算するために特別に設計されたツールです。

RoninDojo のユーザーの場合、このツールはノードに事前インストールされています。RoninCLI からアクセスするには、次の手順を実行します：`Samourai Toolkit > Whirlpool Stat Tool`。

RoninDojo を使用していない場合、Linux マシンに WST ツールをインストールする方法は次のとおりです：

以下が必要です：Tor Browser（または Tor）、Python 3.4.4 以上、git、pip3。

バージョンを確認するには、次のコマンドを入力します：

```bash
python --version
git --version
pip --version
```

依存関係をインストールします：

```bash
pip install PySocks
pip install requests[sock5]
pip install plotly
pip install datasketch
pip install numpy
```

Whirlpool Stats Tool をインストールします：

````bash
# リポジトリをクローンします：
git clone https://code.samourai.io/whirlpool/whirlpool_stats.git

# ディレクトリ/whirlpool_statsに移動します：
cd whirlpool_stats
# pipを使用して依存関係をインストールします：
pip3 install -r ./requirements.txt

WSTの最新バージョンに関して、私自身いくつかの問題がありました。もしもうまく動作しない場合は、完璧に動作する以前のバージョンをgithubからクローンすることもできます：https://github.com/Samourai-Wallet/whirlpool_stats。次の手順は同じです。ただし、この時点では100k satsのプールは存在しなかったため、古いリリースを使用している場合はコードに手動で追加する必要があります。

次に、トランザクションデータを保存するための作業ディレクトリを作成し、WSTを起動します：

#作業ディレクトリに移動します。例えば、ホームに移動します：

```bash
cd ~

# "wst"という名前のディレクトリを作成します：
mkdir wst

# /whirlpool_statsのサブディレクトリに移動します：
cd whirlpool_stats/whirlpool_stats/

# WSTを起動します：
python3 wst.py
````

WST がインストールされ、起動されたら、Anon Sets を計算する方法を説明します。これらの手順は、通常のマシンまたは RoninDojo 上で行う場合でも同じです：

次のコマンドを入力して Tor プロキシを設定します（RoninDojo の場合、このコマンドを必ず使用する必要があります）：

```bash
socks5 127.0.0.1:9050
```

Tor Browser を使用している場合は、Tor Browser が実行中である必要があり、次のコマンドを使用します：

```bash
socks5 127.0.0.1:9150
```

次に、前の手順で作成した作業ディレクトリに workdir コマンドを使用してアクセスします。RoninDojo を使用している場合は、この手順をスキップします：

```bash
#この例では、自分のパスに置き換えてください。
workdir /home/psyduck/wst
```

次に、トランザクションを含むプールのデータをダウンロードします：

```bash
#興味のあるプールの識別コードで0001を置き換えてください。
download 0001
```

WST の識別コードは次のとおりです：

- 0.5 ビットコインのプール：05
- 0.05 ビットコインのプール：005
- 0.01 ビットコインのプール：001
- 0.001 ビットコインのプール：0001

データをダウンロードしたら、次のコマンドでデータをロードします：

```bash
#興味のあるプールの識別コードで0001を置き換えてください。
load 0001
```

データをロードした後、score コマンドに続いてトランザクションの TXID（トランザクション ID）を入力してその Anon Sets を取得します：

```bash
#トランザクションのIDでTXIDを置き換えてください。
score TXID
```

WST は、まず過去のスコア（Backward-looking metrics）を表示し、次に将来のスコア（Forward-looking metrics）を表示します。Anon Sets のスコアに加えて、WST は Anon Set に基づいてプール内の出力の拡散率も提供します。
UTXO の将来のスコアは、初期のミックスの TXID から計算されますが、最後のミックスからではありません。逆に、UTXO の過去のスコアは、最後のサイクルの TXID から計算されます。

## Muuuh xpubs.

Whirlpool の動作に関しては、多くの誤解が存在しています。最も一般的なのは、Samourai がユーザーの xpub にアクセスできるという批判です。

実際には、Whirlpool プロトコルはユーザーの xpub にアクセスする必要はありません。xpub の必要性は、ウォレットのレベルでのみ存在し、特定の目的に限定されます：

- Samourai Wallet で Whirlpool を使用し、独自の Dojo を使用しない場合、Samourai の Dojo はあなたの xpub を知っています。

- Samourai Wallet で Whirlpool を使用し、独自の Dojo を使用する場合、xpub は漏洩しません。

- Sparrow Wallet で Whirlpool を使用し、独自のノードを使用しない場合、接続しているサードパーティのノードはあなたのトランザクションを見ることができます。

- Sparrow Wallet で Whirlpool を使用し、独自のノードを使用する場合、この点では何も漏洩しません。

他の Bitcoin ウォレットと同様に、独自のノードを使用する必要があります。そうしないと、独立性、機密性、信頼性が失われます。ただし、これは Whirlpool プロトコルとは関係ありません。この点において、Samourai Wallet は他の既存のウォレットと同様に動作します。

理論と一般的な動作を見てきたので、実際に試してみましょう！

# 実践セクション

## チュートリアル：Sparrow Wallet での Whirlpool の使用方法。

Whirlpool を使用するための多くのオプションがあります。最初に紹介するのは、PC 上での Bitcoin ウォレットのオープンソースソフトウェアである Sparrow Wallet の実装です。

この方法の利点は、比較的簡単に使い始めることができ、設定が迅速で、コンピュータとインターネット接続以外の特別なデバイスは必要ありません。ただし、この方法には次のセクションで説明する 2 番目のチュートリアルにはない重要な欠点があります：

- ミックスは、Sparrow が起動して接続されている場合にのみ行われます。つまり、24 時間 365 日ビットコインをミックスおよびリミックスしたい場合は、コンピュータを常にオンにしておく必要があります。

この問題の唯一の解決策は、独自の Dojo を使用することです。次のセクションで詳しく説明します。
Whirlpool を使用したことがなく、理解を深めるために効率よりも理解のために現時点で使用したい場合は、メカニズムを理解するために Sparrow をゆっくり始めることをお勧めします。
それでは、一緒にやりましょう：

まず、もちろん Sparrow ソフトウェアが必要です。Sparrow Wallet の公式サイトまたは GitHub から直接ダウンロードできます：

- https://sparrowwallet.com/download/

- https://github.com/sparrowwallet/sparrow/releases

ソフトウェアをインストールする前に、ダウンロードした実行可能ファイルの署名と完全性を確認することが重要です。この手順の実行方法がわからない場合は、Windows での実行方法について以下の記事で説明しています：Windows で Bitcoin ソフトウェアの完全性を確認する方法

ソフトウェアをインストールしたら、Bitcoin ウォレットを作成する必要があります。ミキシングするには、ソフトウェアウォレット（「ホット」ウォレットとも呼ばれる）が必要です。したがって、ハードウェアウォレットで保護されたウォレットではミキシングできません。

必須ではありませんが、大きな金額をミキシングする場合は、このウォレットに強力なパスフレーズを使用することを強くお勧めします。Sparrow でウォレットを作成する方法がわからない場合は、以下の記事の第 5 部で詳しく説明しています：Bitcoin パスフレーズのすべてを知る

ウォレットが作成されたら、ミキシングするために sats をそこに送信します。単に「Receive」をクリックし、通常どおり自分のアドレスに送信します。

ここでは、私がウォレットを作成し、199k sats 以上を送信しました：

![Sparrow WalletでのBitcoinの受信](assets/12.JPEG)

現時点では、通常のアカウントを使用しています。この 0'インデックスのアカウントは、ミキシングのためのデポジットアカウントになります。

受け取ったこの UTXO をミキシングするには、インターフェースの左側にある「UTXOs」をクリックしてアカウントの UTXO リストに移動します：

![Sparrow WalletでミキシングするUTXOの選択](assets/13.JPEG)

次に、ミキシングするさまざまな UTXO をクリックして選択します。複数選択する場合は、Ctrl キーを押しながら各 UTXO をクリックします。選択した UTXO は青くハイライトされます。

次に、インターフェースの下部にある「Mix Selected」ボタンをクリックします：

![Sparrow WalletでBitcoinのミキシングプロセスを開始する](assets/14.JPEG)

Whirlpool の動作を説明するウィンドウが表示されます。これは前の部分で説明した内容の簡略化です。

読み終わったら、「Next」をクリックしてください。

![Whirlpoolの動作の紹介](assets/15.JPEG)
また、アカウントの動作も説明します。 読んだ後に「次へ」をクリックしてください。
![Whirlpoolのアカウントの動作の紹介](assets/16.JPEG)

次のページでは、SCODE を入力することができます。 SCODE は、プールの入場料に適用される割引コードです。 たとえば、Samourai Wallet は、特筆すべきイベント（例：クリスマス）の際に、ユーザーに提供することがあります。 次の SCODE を見逃さないようにするために、Twitter で彼らをフォローすることをお勧めします：https://twitter.com/SamouraiWallet

次に、Tx0 と初期ミックスに割り当てるマイニング手数料を選択してください。 これにより、最初のミックスが確認される速度が影響を受けます。 マイニング手数料は、Tx0 と初期ミックスの際に支払われますが、他のすべてのリミックスには支払われません。

手数料を選択したら、「次へ」をクリックしてください。

![Whirlpoolのマイニング手数料の設定](assets/17.JPEG)

この新しいウィンドウでは、ドロップダウンリストをクリックして入場するプールを選択できます。 ウィンドウには、支払うプールの手数料とこのプールに入る UTXO の数も表示されます。 次に、「プレミックスのプレビュー」をクリックしてください。

私の例では、199k sats の UTXO がありましたので、100k sats のプールには UTXO が 1 つだけ入ります：

![ミックスプールの選択](assets/18.JPEG)

次に、ソフトウェアで作成時に設定したウォレットのパスワードを入力するように求められます。

![Bitcoinウォレットのパスワードの確認](assets/19.JPEG)

そして、Tx0 のプレビューにアクセスできます。

まず、Sparrow が Whirlpool の使用に必要なさまざまなアカウントを派生させたことがわかります。 画面の左側に表示されます。

また、さまざまなアウトプットを持つトランザクションの構造も表示されます：

- プールの手数料（コーディネーター）。

- プレミックスの UTXO。

- Doxxic Change。

![トランザクションの最終的なTx0の確認](assets/20.JPEG)

トランザクションが適切であれば、「トランザクションのブロードキャスト」ボタンをクリックして Tx0 を送信します。 それ以外の場合は、「クリア」ボタンをクリックしてこの Tx0 のパラメーターを変更し、トランザクションの構築をやり直すこともできます。

![Tx0の送信](assets/21.JPEG)

Tx0 が送信されると、Premix アカウントにミックスの準備ができた UTXO が表示されます。 UTXO は現在、コーディネーターによって登録され、初期ミックスに送信されます。

![確認待ちのTx0の送信](assets/22.JPEG)
ここでは、Tx0 からの UTXO が 1 回確認されたことがわかります。また、構築および送信された初期のミックスも表示されますが、まだ確認待ちです：
![Tx0 confirmée, mix initial diffusé](assets/23.JPEG)

Postmix アカウントに移動すると、初期ミックスからの UTXO が送信されていることがわかりますが、まだ確認されていません。確認されると、将来のリミックスに自動的に使用できるようになります。

「Mixes」の列では、異なる UTXO のリミックスの数を確認できます。リミックスの数よりも Anon Sets の方が重要ですが、両方の情報は一部関連しています。

![Mix initial confirmé, UTXO en attente de remixes](assets/24.JPEG)

これで、UTXO がミックスされました。現在、リミックスを待つプールにあります。ミキシングを停止する場合は、「Stop Mixing」ボタンをクリックするだけです。再開するには、「Start Mixing」ボタンをクリックできます。

UTXO をリミックス可能な状態にしたい場合は、Sparrow Wallet ソフトウェアを開いたままにし、コンピュータをオンにしておく必要があります（スリープ状態ではなく）。

オペレーティングシステムのオプションでスリープを無効にすることもできます。また、Sparrow ソフトウェアには、マシンのスリープを防止するオプションもあります：

> Tools > Prevent Computer Sleep

![Empêcher la mise en veille de l'ordinateur](assets/25.JPEG)

Postmix アカウントの UTXO セクションにある「Mix to」ボタンを使用すると、ミックスされた UTXO を自動的に選択したウォレットに送信することができます。送信前に行うリミックスの数を選択できます。

このオプションを使用すると、例えば Postmix をハードウェアウォレットに自動的に送信することができます。ただし、通常はこのオプションの使用は推奨されません。その理由は、「ポストミックスのベストプラクティス」のセクションで説明します。

ここでは Whirlpool を使用したミキシングのオプションの一つを紹介しましたが、他にもあります。たとえば、Android の Samourai Wallet アプリを使用してスマートフォンから直接ミキシングすることもできます。操作方法は、このセクションで説明したものと似ています。

![Samourai](assets/26.JPEG)

チュートリアル：Dojo と Whirlpool GUI での Whirpool CLI。

次のステップに進みたい場合は、独自の Dojo で Whirlpool を使用してミキシングすることができます。

Dojo は、Samourai Wallet チームによって開発された Bitcoin ノードの実装です。Samourai で CoinJoin に独自の Dojo を使用する場合、異なるアカウントの xpub はサードパーティのサーバに送信されません。これにより、Whirlpool に固有のリスクの 1 つを排除することで、プライバシーが向上します。
さらに、Dojo には Whirlpool CLI が統合されており、他のデバイスで常にウォレットを開いておく必要がなく、24 時間 365 日リミックスを実行することができます。

このソリューションでは、Bitcoin ノードを実行する必要があり、前の例よりも設定がやや複雑です。ただし、これにより、最小限のリスクで Whirlpool 上の最高の CoinJoin 体験を享受することができます。

独自の Dojo を実行するには、Dojo ノードを直接インストールするか、他の Bitcoin ノードの実装で Dojo を使用することができます。現時点でこれを許可しているものは次のとおりです。

- RoninDojo は、追加のツールを備えた単なる Dojo であり、インストールおよび管理アシスタントが含まれています。この記事では、RoninDojo の設定と使用方法について詳しく説明します。

- Umbrel を介した「Samourai Server」アプリ。

- MyNode の「Dojo」アプリ。

- Nodl の「Dojo」アプリ。

この例では、次の 3 つの異なるインターフェースを使用します。

- Samourai Wallet。

- Whirlpool GUI。

- Whirlpool CLI。

Whirlpool CLI は、前述の利点を活用するために Dojo 上で実行されます。これがコーディネーターとの通信を担当し、ミックスを管理します。

Whirlpool GUI は、Whirlpool CLI 上での動作を表示し、リモートでミックスを開始するために使用するグラフィカルインターフェースです。GUI は、Dojo とは異なる任意の PC にインストールされ、簡単に管理することができます。

Samourai Wallet は、CoinJoin 用のウォレットをホストします。これは無料でオープンソースのアプリであり、Android またはエミュレータでダウンロードできます。このアプリを使用すると、ミックスウォレットを常に手元に置き、移動中に簡単にポストミックスを使うことができます。

### ステップ 1：Dojo の準備

最初のステップは、Dojo を準備することです。Dojo への接続 URL（Tor アドレス形式）または QR コードを取得する必要があります。このアドレスを使用して、Samourai Wallet を Dojo を介してノードに接続できます。

Umbrel を使用している場合は、左側のメニューで App Store に移動し、「Samourai Server」をインストールします。アプリを起動すると、Dojo への接続用の QR コードが表示されます。

RoninDojo を使用している場合は、ブラウザで RoninUI にアクセスし、ログインしてから、「Dojo」の下の青い「Manage」をクリックします。そこで、「Display Values」をクリックすると、Samourai Dojo の QR コードにアクセスできます。

![Dojo接続アドレス](assets/27.JPEG)

### ステップ 2：ウォレットの準備

ポートフォリオには、Samourai Wallet を使用します。Google Play ストアからダウンロードするか、公式サイトから APK ファイルを直接ダウンロードできます。
アプリを起動し、前のステップで提供された QR コードを使用して Dojo にログインします。ログインしたら、「新しいウォレットを作成」をクリックします。

![SamouraiからDojoに接続する](assets/28.JPEG)

次に、Samourai はパスフレーズの作成を求めます。パスフレーズとは何か、それを適切に設定する方法を知らない場合は、私の記事を読むことを強くお勧めします：ビットコインのパスフレーズについてのすべてを知る。

強力なパスフレーズを選択し、物理的なバックアップを作成します。続行するには、「次へ」をクリックします。

![ウォレットのパスフレーズの作成](assets/29.JPEG)

次に、アプリにアクセスするための PIN を選択する必要があります。この PIN は非常に重要ですが、ビットコインウォレットとは関係ありません。これは Samourai アプリの動作に固有のものです。Samourai アプリからウォレットにアクセスするためには、この PIN が必要です。ただし、ウォレットを復元する必要がある場合は、パスフレーズと復元フレーズ（ニーモニック）のみが必要です。強力な PIN を選択し、バックアップを作成し、「次へ」をクリックします。

![SamouraiアプリのPINの選択](assets/30.JPEG)

PIN を再度確認するように求められます。その後、Samourai ウォレットの復元フレーズにアクセスできます。パスフレーズと同様に、この情報は適切に物理的かつ安全な媒体にバックアップする必要があります。そうしないと、問題が発生した場合にビットコインへのアクセスを永久に失う可能性があります。復元フレーズについて詳しくは、この記事を読むことをお勧めします：ビットコインの復元フレーズとは何ですか？

確認した後、新しい Samourai ウォレットに移動します。何をする前に、バックアップをテストしてください。これを行う前に、ウォレットの xpub を取得して正しいことを確認してください：

> 設定 > ウォレット > BIP44 XPUB を表示

XPUB の値を持つ QR コードが表示されます。この xpub の最後の 8 文字を紙に書き留めてください。例えば：

> X2GGWaLt

これにより、正しいウォレットにいることと、パスフレーズの入力ミスがないことを確認できます。

次に、空のウォレットを上書きするか、Samourai アプリを再インストールし、以前に作成したバックアップのみを使用してウォレットを再構築してみてください。これを行うには、Dojo にログインした後、「既存のウォレットを復元」をクリックします。
物理的なバックアップに記載されている回復フレーズとパスフレーズを入力し、以前と同じ PIN を選択してこのウォレットを復元してください。うまくいかない場合は、回復フレーズのバックアップが正しくない可能性があります。ステップ 2 を最初からやり直してください。

ウォレットにアクセスできたら、最初の XPUB BIP 44 が変わっていないか確認してください。以下に移動してください：

> 設定 > ウォレット > BIP44 XPUB を表示

最後の 8 文字が以前にメモしたものと一致しているか確認してください。一致しない場合は、パスフレーズのバックアップが正しくない可能性があります（または、入力ミスがあるかもしれません）。ステップ 2 を最初からやり直してください。

バックアップが正常に機能している場合は、次のステップに進んでください。

> 新しいウォレットのバックアップテストは、Samourai だけでなく、他のどのウォレットでも実行する必要があることに注意してください。

### ステップ 3：Whirlpool GUI の準備

Whirlpool GUI、CoinJoin を管理するためのグラフィカルインターフェースをインストールします。個人用のコンピュータにアクセスしてください。

まず、Java 開発キット（JDK）をインストールする必要があります。たとえば、OpenJDK を無料で次のサイトからインストールできます：https://adoptopenjdk.net/ これにより、Java で開発されたソフトウェアをコンパイルおよび実行することができます。

![OpenJDKのインストール](assets/31.JPEG)

OpenJDK がインストールされたら、Samourai Wallet の公式サイトから Whirlpool GUI をインストールできます：https://samouraiwallet.com/download/whirlpool

Whirlpool GUI を起動してください。Whirlpool GUI に接続するためには、PC で Tor Daemon または Tor Browser がバックグラウンドで実行されている必要があります。Whirlpool GUI を使用する前に、これらを起動する必要があります。Tor を使用できない場合は、開始する前に公式サイトから Tor をインストールしてください：https://www.torproject.org/download/

![Whirlpool GUIの接続オプションの選択](assets/32.JPEG)

Whirlpool GUI から、「Advanced: Remote CLI」をクリックして Whirlpool CLI を Dojo に接続します。Whirlpool CLI の Tor アドレスが必要です。

- Umbrel で見つける方法：単に Samourai Server アプリを起動し、ページ上で見つけることができます。

- RoninDojo で見つける方法：RoninCLI のメインメニューに移動し、Credentials > Whirlpool に移動します。

Whirlpool GUI で、先ほど見つけた Tor アドレスを「CLI address」の欄に入力してください。先頭の「http://」はそのままにし、「:8899」は入力しないでください。与えられたアドレスをそのまま貼り付けてください。
次のフィールドには、Tor Daemon を使用している場合は 9050、Tor ブラウザを使用している場合は 9150 を入力してください。Whirlpool GUI から Whirlpool CLI に初めて接続する場合は、API キーフィールドを空白のままにしておくことができます。それ以外の場合は、API キーフィールドに情報を入力してください。
![Whirlpool GUIをDojoに接続する](assets/33.JPEG)

Whirlpool GUI を Whirlpool CLI にペアリングするために、「Connect」ボタンをクリックしてください。接続を確立するまでには、しばらく時間がかかる場合がありますので、お待ちください。

次に、Samourai ウォレットをペアリングすることができます。画面の右側にある QR コードのシンボルをクリックしてください。

![Whirlpool GUIをSamouraiウォレットに接続する](assets/34.JPEG)

Samourai ウォレットから次の場所に移動してください：

> ... > Settings > Transactions > Whirlpool GUI とのペアリング

Samourai の QR コードを Whirlpool GUI にフラッシュしてください。

![SamouraiウォレットをWhirlpool GUIにペアリングする](assets/35.JPEG)

Whirlpool GUI で接続が確立されていることを確認してください。次のページで、「Use Dojo as wallet backend」を有効にし、「Initialize GUI」ボタンをクリックしてください。

![Whirlpool GUIの設定](assets/36.JPEG)

次に、Samourai ウォレットのパスフレーズを確認するように求められます。完了したら、「Sign in」をクリックしてください。

![ウォレットのパスフレーズの確認](assets/37.JPEG)

しばらくお待ちください。設定が完了すると、Whirlpool GUI にアクセスできます。

![Whirlpool GUIのインターフェースへのアクセス](assets/38.JPEG)

### ステップ 4：ミキシング！

すべての準備が整いました。ビットコインをミキシングする準備ができました。これを行うには、Samourai ウォレットの Deposit アカウントにミキシングする sats を送信してください。また、Whirlpool GUI から直接行うこともできます。

「Deposit」ボタンをクリックして、受信アドレスを生成してください。

![ビットコインの受信アドレスの生成](assets/39.JPEG)

このページでは、特定のプールに入るための最小入金額を確認することができます。マイニング手数料が下がるまで、望むプールに UTXO が入ることができない可能性があるため、常に少し余分に用意してください。

生成されたアドレスにビットコインをミキシングするために送金してください。新しいアドレスを生成するには、「Renew address」ボタンをクリックしてください。

入金の安全性を高めるために、Samourai ウォレットで資金を入金することをお勧めします。アプリケーションの右下にある青い+ボタンをクリックし、「Receive」をクリックしてください。
デポジットが確認されると、Whirlpool GUI の「Deposit」アカウントに表示されるようになります。Coinjoin のシリーズを開始するには、ミックスに送信する UTXO を選択し、「Premix」ボタンをクリックします。注意してください、複数の異なる UTXO を同時に選択すると、それらは TX0 でマージされます。これは、特に UTXO のソースが異なる場合には、プライバシーの損失につながる可能性があります。
![Tx0 mixの起動](assets/40.JPEG)

Whirlpool の設定ページが開きます。参加したいプールを選択してください。TX0 と最初の CoinJoin に割り当てられるマイニング手数料を選択します。ページの下部には、おつりの金額、均等化された UTXO の金額と数が表示されます。設定が適切であれば、「Premix」ボタンをクリックして CoinJoin プロセスを開始します。

![Tx0 mixの設定](assets/41.JPEG)

TX0 が作成されると、確認待ちの「Premix」アカウントに均等化された UTXO が表示されます。Premix が自動的にミックスされ、将来の postmix が 24 時間/7 日間自動的にリミックスされるようにしたい場合は、ウィンドウの左側にある「Configuration」タブから「Automatically mix premix & postmix」オプションを有効にしてください。

これで Whirlpool GUI を終了することができます。Whirlpool CLI を使用して、Dojo 上の Whirlpool CLI を介して 24 時間/7 日間 CoinJoin が利用できる UTXO が利用可能です。

Whirlpool GUI の「Postmix」アカウントまたは Samourai Wallet の Whirlpool インターフェースから UTXO を確認することができます。これを行うには、画面の左上にある Samourai のロゴをクリックしてください。Whirlpool アカウントは、明るい青色で Samourai Wallet 上で簡単に区別できます。

![SamouraiからCoinJoinを観察する](assets/42.JPEG)

postmix を使うには、画面の右下にある+ボタンをクリックし、適切な支出ツールを選択してください。

自動ミックスを簡単に追跡するために、Android アプリの Sentinel を使用してウォッチオンリーポートフォリオを設定することもお勧めします。PostMix アカウントの ZPUB を入力し、CoinJoin の進行状況をリアルタイムで追跡できます。

# post-mix のベストプラクティス

ミックスした後、ミックスで得たプライバシーを失いたくない場合は、いくつかのベストプラクティスを守ることが重要です。

## post-mix の UTXO

ミックスした後は、UTXO を PostMix ウォレットに保持しておくことが最善の選択肢です。必要なものを購入するまで、無制限にリミックスさせておくことさえできます。
一部のユーザーは、ビットコインをハードウェアウォレットで保護された安全なウォレットに移動することを好むかもしれません。これは可能ですが、Samourai Wallet の提供する推奨事項に非常に注意し、それに従う必要があります。それをしないと、以前に得たすべてのプライバシーを失う可能性があります。

最も一般的なエラーは UTXO のマージです。マージ、つまりミックスされた UTXO とミックスされていない UTXO を同じトランザクションのインプットに入れることは絶対に避ける必要があります。これにはウォレット内での UTXO の管理とラベリングが必要です。CoinJoin を超えて、UTXO のマージは一般的には悪い慣行であり、制御されていない場合にはプライバシーの損失につながることがよくあります。

また、ミックスされた UTXO 同士の統合にも注意が必要です。ミックスされた UTXO が重要な Anon Sets を持っている場合、小さな統合を行うことは可能ですが、これによりビットコインのプライバシーレベルが低下します。

統合があまりにも大きくなりすぎたり、リミックスがあまりにも少ない場合、CoinJoin 前後の UTXO 間に単純な推論によるリンクが可能になることに非常に注意してください。これらの概念を十分に理解していない場合、最も安全な方法は、ミックス後の UTXO を統合せずに 1 つずつハードウェアウォレットに送り、毎回新しい空のアドレスを使用することです。再度、受け取った各 UTXO に適切なラベルを付けることを忘れないでください。

また、マイナリティスクリプトを使用するウォレットにミックス後の UTXO を移動することもお勧めしません。例えば、Whirlpool にマルチシグスクリプト（P2WSH スクリプト）を使用して入る場合、元々同じタイプのウォレットを使用している他のユーザーと混ざる可能性は低いです。ミックス後の UTXO を同じマルチシグウォレットに戻すと、ミックスされたビットコインのプライバシーレベルが大幅に低下します。

また、他のビットコイントランザクションと同様に、受け取りアドレスを再利用しないように注意する必要があります。受け取りアドレスは一度限りの使用です。新しいトランザクションが入るたびに新しい空のアドレスを生成する必要があります。

> 1 UTXO = 1 アドレス

したがって、最も簡単で安全な方法は、ミックスされた UTXO をそのまま PostMix ウォレットに保持することです。ミックスされた UTXO が再度ミックスされるのを待ち、使用するときにのみ操作することです。

## ドキシックな UTXO の変更

次に、"Doxxic Change"の管理に注意する必要があります。これは、ミキシングプールに入ることができなかったチェンジです。Whirlpool の使用によって作成されたこれらの有害な UTXO は、CoinJoin の使用とあなた自身の間にリンクを作成するため、プライバシーに危険です。したがって、それらを何にでも使用せず、他の UTXO と絶対に統合しないように注意する必要があります。以下は、できることです：

- より小さなプールでミキシングする：UTXO が十分に大きい場合、単独でより小さなプールに入ることができる場合は、ミキシングしてください。これはおそらく最良の解決策の一つです。ただし、複数の Doxxic Change を統合してプールに入れることは絶対に避けてください。これは Whirlpool への異なる入力間のリンクを作成するため、良いアイデアではありません。

- "非使用可能"としてラベル付けし、専用のアカウントに保持する：別の良い解決策は、それらに触れずに"非使用可能"としてラベル付けし、使用しないように確信することです。Bitcoin の価格が上昇すると、新しい小さなプールが作成される可能性があり、これにより小さな Doxxic Change を適切にミキシングできるようになります。

- 寄付する：Bitcoin や関連ソフトウェアに取り組んでいるさまざまな開発者や、これらのソフトウェアの使用方法を理解するのに役立つコンテンツの制作者に対して、自分のできる範囲で小さな寄付をすることが重要です。また、Bitcoin で支払いを受け付けるさまざまな団体に寄付することも選択できます。もし Doxxic Change が負担になっている場合は、寄付をして解消してください。

- ギフトカードの購入に使用する：一部のサイトでは、Bitcoin と引き換えにさまざまな有名な店舗で利用できるギフトカードを購入することができます。このようなタイプのギフトカードを購入することで、Doxxic Change を取り除くことができます。

Doxxic Change を取り除くための他のテクニックも確実に存在します。一部の人々は、Lightning Network を使用して匿名化する方法や、Monero とのスワップを使用していると言っています。これらのテクニックは良いかもしれませんが、私はこの記事では取り上げていません。これらのトピックについては、自分で調査してみてください。

# 支出ツール

したがって、Post-Mix では、ミキシングされた UTXO を専用のアカウントに保持し、それを分離するまで触れないことが最も安全な方法です。

最後に、ミキシングされた UTXO の支出までプライバシーを最適化するために特別に設計されたツールを使用することが重要です。
これらのツールの利用可能性は、ユーザーが選択したウォレットソフトウェアに依存します。Samourai Wallet は、提供されるツールの多様性と効率性によって他のウォレットとは明確に異なります。これらのツールの一部は、Sparrow Wallet でも利用可能です。これらのツールとその使用方法について見ていきましょう。

## PayJoin - Stowaway.

PayJoin は、特定の構造を持つ 2 人の間の CoinJoin です。これはビットコインの支出の一環として使用されます。ミックスされたビットコインを支出するためだけでなく、ミックスされていないビットコインを支出するためにも使用することができます。

この特定のトランザクション構造は、最初に Samourai Wallet によって Stowaway ツールとして実装されました。その後、この実装に続いて、PayJoin のアイデアを取り入れ、P2EP（Pay-to-End-Point）という名前に変更した BIP が作成されました。

PayJoin の特異性は、一見普通のトランザクションを生成するが、実際には 2 人のユーザー間の小さな CoinJoin であるという点です。そのため、トランザクションの構造では、実際の送信者とともにトランザクションの受信者も入力に関与します。したがって、受信者は自分自身への支払いをトランザクションの中間に含めることで支払われます。

例えば、あなたが自分の UTXO（未使用トランザクション出力）から 4000 sats でパンを買いたい場合、そして PayJoin を行いたい場合、あなたのパン屋はあなたの元のトランザクションに彼自身の所有する 15,000 sats の UTXO を追加し、それを完全にアウトプットとして回収してヒューリスティック分析を混乱させます：

![Bitcoin PayJoinトランザクションのスキーマ](assets/43.JPEG)

この例では、パン屋が 15,000 を入力し、19,000 で出力していることがわかります。差額は確かに 4,000 sats で、それがパンの価格です。あなたは 4,000 sats でパンを買いたいので、10,000 で入力し、6,000 で出力しています。差額は確かに-4,000 sats で、それがパンの価格です。この例では、簡単にするためにマイニング手数料を意図的に無視しました。

この構造により、PayJoin はビットコインのトランザクションの共通入力のヒューリスティックを破ります。誰かがこの支払いを観察すると、あなたが単に 2 つの UTXO を結合して 19,000 sats で商品を購入し、6,000 sats でお釣りをもらったと思うでしょう。実際には、状況は全く異なることがわかりました。したがって、チェーンの分析は混乱し、支払いのパラメータは観察者にとって理解しにくくなります。

この種のトランザクションは、プライバシーを損なうことなく、ミックスされたビットコインを支出するための優れた解決策となり得ます。

JoinMarket には、支出のための PayJoin ツールも含まれています。詳細はこちらをクリックしてご覧ください。
前述のように、Samourai Wallet には PayJoin ツールである Stowaway もあります。Sparrow Wallet ソフトウェアまたは Samourai Wallet アプリから選択して使用することができます。
Stowaway は、彼らが「Cahoots」と呼ぶトランザクションタイプに基づいており、複数のユーザー間での協力的なトランザクションを意味します。このトランザクションでは、ビットコインチェーンの外で情報の交換が必要です。現在、Samourai には Stowaway と StonewallX2 の 2 つの Cahoots ツールが存在しますが、これについては後ほど詳しく説明します。

Cahoots の協力的なトランザクションでは、ユーザー間で部分的に署名されたトランザクションを交換する必要があります。このプロセスは非常に時間がかかるため、特に他のユーザーと物理的に離れている場合には実行が困難です。ただし、Samourai Wallet の他のユーザーと手動でこれを行うことは常に可能であり、協力する相手と物理的に同じ場所にいる場合には良いオプションとなります。手動プロセスでは、1 つずつスキャンするために 5 つの QR コードの交換が行われます。

遠隔地では、この手順は複雑すぎます。そのため、Samourai は素晴らしいソリューションを開発しました。Tor 上に確立された自社の暗号化通信プロトコルである Soroban です。Soroban により、ユーザーはこれらの QR コードの交換をすべて行う必要がありません。交換は自動的にバックグラウンドで行われ、最適化されたユーザーインターフェースの背後に隠れています。

暗号化された交換には、Cahoots の協力者間での接続と認証の形式が必要です。したがって、Soroban の交換はユーザーの PayNyms 上で行われます。PayNyms が何であるかわからない場合は、この記事で詳しく説明しています：PayNym と BIP47 とは何ですか？

簡単に説明すると、PayNym はウォレットに関連付けられた識別子であり、さまざまな機能、特に暗号化されたメッセージの交換を実現するためのものです。PayNym は識別子とロボットの図面で表されます。以下は私の例です（テストネット上）：

![Sparrow WalletのPayNym](assets/44.JPEG)

リモートで Cahoots トランザクション、つまり Samourai または Sparrow を介した PayJoin を実行するには、他のユーザーの PayNym を「Follow」する必要があります。具体的には、Stowaway（PayJoin）を実行するためには、ビットコインを送信したい相手をフォローする必要があります。

Sparrow Wallet からこれを行うには、「Find Contact」の欄に PayNym を入力するか、協力者の QR コードをスキャンするだけです。前のスクリーンショットで見ることができます。

Samourai では、画面の右下にある青い「+」をクリックし、「PayNyms」をクリックします。まだ PayNym を持っていない場合は、指示に従って自分自身の PayNym を生成することができます。
![Samourai WalletのBitcoinウォレット](assets/45.JPEG)
**Testnet で行われたチュートリアル：これは本物のビットコインではありません。**
PayNym のインターフェースに入ったら、青い「+」をタップしてください。その後、相手の PayNym をフォローするために、彼の識別子を貼り付けるか、QR コードをスキャンすることができます。

次に、「Follow」をクリックしてください：

![Suivre un PayNym](assets/46.JPEG)

次に、「接続」するかどうかを尋ねられます。この機能を使用すると、後で BIP47 を使用することができますが、いくらかの手数料がかかります。私たちの場合、それは必要ありませんので、接続しません。

![Se connecter à un PayNym](assets/47.JPEG)

私の例では、Samourai Wallet と Sparrow Wallet の間で PayJoin を行いました。Sparrow Wallet で PayNym にアクセスするには、単に「Tools」をクリックしてから「Show PayNym」をクリックしてください。

![Montrer le PayNym sur Sparrow Wallet](assets/48.JPEG)

ここでは、私のオレンジの PayNym が私の白い PayNym（Samourai 上のもの）からのフォローリクエストを受け取ったことがわかります。私は親切なので、フォローバックしました：

![Suivre PayNym sur Sparrow Wallet](assets/49.JPEG)

今、Nym が接続されているので、彼らは Soroban を介して暗号化された形で通信することができます。したがって、Cahoots トランザクションを開始することができます。

Samourai から PayJoin Stowaway を実行するには、トランザクションを構築する必要があります。ミックスされた UTXO を使いたい場合は、トランザクションを開始する前に Post-mix アカウントに移動してください。

青い「+」をクリックして、「送信」をクリックしてください。また、特定の UTXO を送信することもできます：

![Créer un PayJoin Bitcoin depuis Samourai Wallet](assets/50.JPEG)

次に、送信したい金額を入力してください。私の例では、45,000 sats Testnet を送信しています：

![Paramétrage du PayJoin Stowaway](assets/51.JPEG)

「Cahoots」をクリックしてください。このウィンドウが開き、StonewallX2 または Stowaway のいずれかを選択することができます。ここでは、Stowaway を行いたいと思います：

![Choix du type de Cahoots transaction collaborative Bitcoin](assets/52.JPEG)

前述のように、PayJoin を手動で行うか、リモートで行うことができます。リモートで行う方が速く簡単ですが、PayNym 経由で接続する必要があります。私たちの場合、この「Online」オプションを選択します：

![Choix du type de collaboration manuelle ou soroban](assets/53.JPEG)

次に、PayNym の連絡先から共同作業者を選択してください。ここでは、Sparrow 上の私のオレンジの PayNym である「luckyfrost」を選択します：

![Choix du collaborateur](assets/54.JPEG)

「Vérifier Transaction」をクリックして確認してください。

![Vérification de la transaction Bitcoin PayJoin Stowaway](assets/55.JPEG)
その後、このトランザクションに割り当てられるマイニング手数料を選択することができます。これらの手数料は、トランザクションの最初の送信者によって支払われます。 "スタートスティーウェイ"をクリックしてください。
![マイニング手数料の選択](assets/56.JPEG)

次に、相手がこの共同トランザクションを実行することに同意していることを確認するために待つように求められます。

Samourai での共同トランザクションのリクエストを確認するには、青い "+" をクリックし、緑色の "受信" をクリックします。アドレスが表示されます。右上の三点リーダーをクリックし、"オンライン共同トランザクションの受信"をクリックします。

Sparrow Wallet で確認するには、"ツール"タブをクリックし、"ミックスパートナーを検索"をクリックします。ウィンドウが開き、"次へ"をクリックし、トランザクションの共同実行を確認するためにもう一度 "次へ"をクリックします。

共同トランザクションが進行中です。Soroban を介して、Tor 上で部分的に署名された暗号化されたトランザクションが 2 つのウォレット間で交換されます。

![StowawayのSorobanによる共同トランザクションの進行](assets/57.JPEG)

Stowaway トランザクションが構築されたら、Bitcoin ネットワークのノードにトランザクションを送信するためにトランザクションをブロードキャストすることができます。

![Cahoots完了、PayJoin Stowawayトランザクションのブロードキャスト](assets/58.JPEG)

これで、Stowaway トランザクションがブロードキャストされました。おめでとうございます。

トランザクションを観察すると、2 人のユーザーのインプットとアウトプットが表示されます。白い PayNym のアウトプットとインプットの差は-45,000 sats であり、オレンジの PayNym の差は+45,000 sats であり、私が最終的に送信した金額です。

![PayJoin Stowawayトランザクションの構造](assets/59.JPEG)

### Stonewall.

Stonewall は、CoinJoin ではないが、2 人の人物間で CoinJoin を模倣する特定のトランザクション構造です。

このトランザクションは共同的ではなく、トランザクションの送信者に属する UTXO のみが関与します。したがって、誰とも合意する必要なく、どんな場合でも Stonewall トランザクションを作成することができます。

その動作は非常にシンプルです：送信者に属する複数の UTXO をインプットとして使用し、4 つのアウトプットを作成します。これらのアウトプットのうち 2 つは同じ金額であり、他のものはおつりです。これら 2 つの類似したアウトプットのうち、実際に支払い先に送られるのは 1 つだけです。

この構造はトランザクションに大量のエントロピーを追加し、トレースをかき乱します。外部から見ると、このトランザクションは 2 人の人物間の CoinJoin であると思われますが、実際には支払いです。したがって、チェーン分析に疑念を抱かせることができます。

この Stonewall ツールは、Samourai Wallet ではデフォルトで使用されます。ウォレットが必要な条件を満たしている場合、一緒に Stonewall を作成する方法を見てみましょう。そのために、このツールを使用して 50,125 sats を送信します：
![ビデオ](assets/60.mp4)
このビデオで見るように、デフォルトで Stonewall オプションが選択されています。

以下は、ビデオで行った Stonewall トランザクションの構造です：

![Stonewallトランザクションの構造](assets/61.JPEG)

Samourai は、私の所有する 2 つの UTXO を入力として集約していることがわかります：

- 130,450 S

- 454,504 S

そして、Stonewall トランザクションの 4 つのアウトプットを認識することができます：

- 私が行った実際の支払いである 50,125 S。

- 別の私のアドレスに戻る 50,125 S。

- 2 つのお釣り：80,168 S と 404,222 S も私に戻ってきます。

したがって、私の受取人は私が初めに開始した支払いの値である 50,125 sats のみを受け取りました。

もちろん、ポストミックスを使いたい場合は、トランザクションを開始する前に Whirlpool ウォレットに移動する必要があります。

Samourai は Stonewall トランザクションの構築に対して手数料を請求しません。ただし、トランザクションのマイニング手数料は支払う必要があります。これは、より多くのインプットとアウトプットを持つため、通常のトランザクションよりも高くなります。

Sparrow でこのツールを使用したい場合は、次のチュートリアルを参照して操作方法を詳しく説明しています：https://sparrowwallet.com/docs/spending-privately.html#paying-to-a-paynym

## StonewallX2.

StonewallX2 は、Stonewall と同様に機能しますが、トランザクションの入力は送信者だけでなく、第三者のものも含まれます。したがって、StonewallX2 は Samourai の 2 人のユーザー間での共同トランザクションです。Stowaway（PayJoin）と同様に、共同作業者間のコミュニケーションは手動で行うことも（同じ場所にいる場合）Tor を介したリモートでも行うことができます。

Stowaway と StonewallX2 の違いは、共同作業者の役割にあります。Stowaway の場合、共同作業者は支払いの受取人である必要があります。StonewallX2 の場合、共同作業者は単にビットコインを混合するために提供するだけであり、支払いの受取人ではありません。

例えば、機密性を保ちながら支出をしたいが、ビットコインを送りたい商人が Stowaway をサポートしていない場合、トランザクションとは関係のない別の人と単に StonewallX2 を行うことができます。受取人は常に商人ですが、商人は Stowaway に関連するすべての操作を行う必要はありません。
したがって、StonewallX2 は、支出のアウトプットを含む 2 人の間のミニコインジョインであり、トランザクションに非常に多くのエントロピーを追加することができます。この特定の構造は、送信者と受信者の間のリンクに統計的な疑いを追加します。
StonewallX2 トランザクションを外部から見ると、その構造は Stonewall トランザクションとまったく同じになります。これにより、さらに多くの疑いを追加することができます。

リモートで StonewallX2 トランザクションを行うには、共同作業者の PayNym と接続する必要があります。これは stowaway と同じ方法です。共同作業者と接続したら、一緒にリモートで StonewallX2 トランザクションを行う方法を見てみましょう。この例では、Sparrow Wallet の 2 番目の PayNym と協力しています。ビデオでは表示していませんが、Cahoot の共同作業者は、ジョイントトランザクションに参加することをウォレットで確認する必要があります。

![ビデオ](assets/62.mp4)

以下は、ビデオで行った StonewallX2 トランザクションの構造です：

![共同ビットコインStonewallX2トランザクションの構造](assets/63.JPEG)

最初の 102,588 S のインプットは、私の Samourai ウォレットから来ています。2 番目の 104,255 S のインプットは、共同作業者のウォレットから来ています。トレースをかき混ぜるために、2 つの同じ金額のアウトプットが 4 つあります：

- 50,125 sats は私の支払い先に送られます。

- 52,306 sats は私のお釣りを表し、私のウォレットのアドレスに戻ります。

- 50,125 sats は共同作業者に戻ります。

- 53,973 sats は共同作業者に戻ります。

StonewallX2 トランザクションのマイニング手数料は、2 人の共同作業者で共有されます。トランザクション後の各自の残高を計算すると、次のようになります：

- 共同作業者は 104,255 sats で入り、104,098 sats で出ます。差額はマイニング手数料の割合です。これらの手数料を無視すると、共同作業者は実際にはダミートランザクションを行いました。

- 送信者の場合、102,588 sats で入り、52,306 sats で出ます。差額の 50,282 sats は、受信者に支払う金額（50,125 sats）とマイニング手数料の割合を表しています。

- 受信者はトランザクションに参加せず、50,125 sats で出ます。これは私が支払いたい金額です。

Samourai は StonewallX2 トランザクションの構築に対して料金を請求しません。もちろん、トランザクションのマイニング手数料を支払う必要があります。これは「通常の」トランザクションよりも入力と出力が多いため、より高額になります。
Sparrow でこのツールを使用したい場合は、次のチュートリアルを参照して操作方法を詳しく説明しています：https://sparrowwallet.com/docs/spending-privately.html#paying-to-a-paynym

## Ricochet.

最後に紹介するツールは Ricochet です。このツールは、プライバシーを向上させることを目的とした以前のツールとは少し異なります。Ricochet は、CoinJoin が UTXO に残すトレースを減らし、その結果、過去のトランザクションのプライバシーを向上させることができます。

CoinJoin などのトランザクションを行い、ミックスされたビットコインを直接取引所に送金する場合、プロバイダーによってアカウントがブロックされたり、資金の出所についての正当性を求められる可能性があります。このような虚偽で不公正なブロックを回避するために、Ricochet を使用してミックスされた資金を取引所に送金することができます。

したがって、Ricochet の唯一の使用ケースは、所有している UTXO で過去に CoinJoin を行ったことを隠したい場合です。

このトレースを減らすために、Ricochet は 4 つのトランザクションを実行し、異なるアドレスに自分自身に資金を送り、その後、ツールが資金を最終目的地（取引所）に送ります。目的は、CoinJoin トランザクションと入金トランザクションの間に距離を追加することです。これにより、チェーン分析ツールは CoinJoin 以降に所有者が変更されたと考え、プロバイダーはおそらくアカウントをブロックしたり正当性を求めたりするリスクを取らないでしょう。

このツールは、ミックスされたビットコインを交換する必要がある場合や、単に過去のミックスの「トレース」を減らしたい場合に重要です。

前述のように、リバウンドアドレスに使用される Ricochet アカウントは、入金アカウントとは完全に分離されたアカウントです。

Ricochet には 2 つのオプションがあります：

- 強化された Ricochet：または「段階的な配送」とも呼ばれ、このオプションでは Samourai に支払われる手数料が 5 つのリバウンドトランザクションに均等に分散されます。また、各リバウンドが異なるブロックに存在することが保証されます。このオプションは遅いですが、操作のプライバシーとチェーン分析への耐性を最適化することができます。

- 通常の Ricochet：このオプションは操作を迅速に行うことができますが、前のオプションよりもプライバシーとチェーン分析への耐性が低くなります。緊急の送金にはこのオプションを選択することをお勧めします。

Ricochet は有料のサービスです。Samourai に 100,000 sats の手数料を支払う必要があります。

以下は Samourai Wallet で Ricochet を行う方法です：

![video](assets/64.mp4)
あなたは今、Whirlpool を最善の方法で使用し、自分のポストミックスを適切に使う準備が整いました。Samourai Wallet の支出ツールは、ほとんどの場合、Sparrow Wallet にも含まれており、あなたにはもう秘密ではありません。練習して、これらのツールを試してみることをお勧めします。個人の資金を危険にさらすことなく、まずはテストネット上で使用してみてください！このネットワークは開発者に限定されたものではありません。

# ビットコインをミックスすることは悪いことですか？

Altcoiners や初心者の議論では、CoinJoin を暗い、疑わしい、または危険な行為として描写することがよくあります。このような曖昧な話は、Bitcoin の技術的な無知と CoinJoin の幻想によるものです。

これらは明らかに間違っています。CoinJoin は、個人が支払いのプライバシーを取り戻すことができる、Bitcoin の高貴な使用方法であり、支払いネットワークの外部の交換性を向上させるためのものであり、完全な匿名性に陥ることはありません。

前述のように、CoinJoin は単にユーザーがビットコインの履歴を切り取り、支払いのプライバシーを向上させることを可能にするものです。特に過去に彼らの身元が UTXO に関連付けられていた場合に有効です。

個々のユーザーが自分のプライバシーを保護するためのこれらのツールのおかげで、制約のない自由な支払いネットワークを実現することができます。プライバシーの尊重がなければ、自由は存在しません。

Bitcoin のユーザーのプライバシーを尊重することは高貴な目的です。CoinJoin を行うことで、個人的なプライバシーを確保するだけでなく、多くの他の個人のプライバシーを向上させる手助けもします。

はい、CoinJoin は時には不正な人々によって使用されます。しかし、それは同様に、プライバシーの必要性が快適ではなく、義務である人々によって広く使用されています。もし誰もが CoinJoin を個別に必要な時にのみ使用した場合、本当にこのツールを使用する必要がある人々は不正な人々と混ざり合い、圧政的な権威に対してより簡単に検出される可能性があります。

私はまた、Gregory Maxwell の議論を引用します。彼は 2013 年の Bitcoin Talk で CoinJoin の導入時に述べた次のような主張をしています。「実際の犯罪者は CoinJoin を必要としません。[...]彼らは通常のユーザーができない方法でプライバシーを購入することができますが、それは彼らのビジネスに追加のコストです（しばしば非常に利益が出る）。」

いずれにせよ、CoinJoin はツールです。他のツールと同様に、建設的な方法または破壊的な方法で使用することができます。
最後に、私の意見では、CoinJoin は Bitcoin のイデオロギーと初期の開発方針に完全に適合しています。サイファーパンクはコードを書きます。彼らは個々のプライバシーとインターネット上の主権を確保するためのツールを開発し、個人の自由を保証するために不可欠な 2 つの特徴を持っています。

Satoshi Nakamoto 自身も、Bitcoin のユーザーのプライバシーを尊重するために彼のホワイトペーパーの一部を捧げています。彼は、鍵の所有者が明らかにされた場合、機密性の喪失のリスクを強調しています。それが起こった場合、所有者のすべてのトランザクションを追跡することができると説明しています。CoinJoin は、ホワイトペーパーで Satoshi Nakamoto によって説明されたビットコインと所有者の間のこのリンクを断つための現在の最良の解決策です。

最後に、この記事を作成するために私が参考にした以下の「外部リソース」セクションのさまざまなコンテンツを学ぶことをお勧めします。これらのコンテンツは、さらに多くの知識を提供してくれるでしょう。

さらに学ぶために：

- [ビットコインのパスフレーズについてのすべての知識](https://www.pandul.fr/post/tout-savoir-sur-la-passphrase-bitcoin)

- [自分自身でビットコインのニーモニックフレーズを生成する方法](https://www.pandul.fr/post/comment-g%C3%A9n%C3%A9rer-soi-m%C3%AAme-sa-phrase-mn%C3%A9monique-bitcoin)

- [PayNym と BIP47 とは何ですか？](https://www.pandul.fr/post/qu-est-ce-que-paynym-et-bip47)

外部リソース：

@SamouraiWallet の Twitter スレッド「Why we CoinJoin」：

https://twitter.com/SamouraiWallet/status/1489220847336308739

ECONOALCHEMIST によるデスクトップでの WHIRLPOOL の方法に関する記事「HOW TO WHIRLPOOL ON DESKTOP WITH RONINDOJO」：

https://bitcoinmagazine.com/guides/how-to-whirlpool-with-ronindojo

ECONOALCHEMIST によるビットコインの WHIRLPOOL とプライバシーの保存方法に関する記事「THE EASIEST WAY TO WHIRLPOOL YOUR BITCOIN AND PRESERVE PRIVACY」：

https://bitcoinmagazine.com/guides/how-to-whirlpool-bitcoin-on-mobile

ECONOALCHEMIST による SPARROW WALLET を使用したデスクトップでのビットコインの WHIRLPOOL 方法に関する記事「HOW TO WHIRLPOOL YOUR BITCOIN ON DESKTOP WITH SPARROW WALLET」：

https://bitcoinmagazine.com/technical/how-to-whirlpool-bitcoin-sparrow-wallet

Samourai Wallet による「Diving head first into Whirlpool Anonymity Sets」の記事。

https://medium.com/samourai-wallet/diving-head-first-into-whirlpool-anonymity-sets-4156a54b0bc7

@BrotherRabbit\_の Twitter スレッド「Whirlpool の見通しスコアについて」：

https://twitter.com/BrotherRabbit_/status/1528399310227906561

Découvre Bitcoin の YouTube チャンネルの JohnOnChain による Samouraï チュートリアル（プライバシー）：

https://www.youtube.com/watch?v=kS6iC_ovarQ
Ricochet に関するリソース：
https://docs.samourai.io/en/wallet/features/ricochet

Sparrow Wallet の支出ツールに関するリソース：
https://sparrowwallet.com/docs/spending-privately.html#paying-to-a-paynym

Samourai Wallet の支出ツールに関するリソース：
https://docs.samourai.io/en/spend-tools#ricochet

WST のインストールと使用に関する記事（スペイン語）：
https://estudiobitcoin.com/como-instalar-y-utilizar-whirlpool-stats-tools-wst-para-los-calculos-de-los-sets-de-anonimato-de-las-transacciones-coinjoins/

BitcoinQ+A の Coinjoin Change Outputs に関する記事（Bitcoiner.guide）：
https://bitcoiner.guide/doxxic/

Samourai Wallet による OXT による Bitcoin プライバシーの理解に関する 4 つの記事シリーズ：
https://medium.com/oxt-research/understanding-bitcoin-privacy-with-oxt-part-4-4-16cc0a8759d5

Samourai Wallet による Whirlpool に関するリソース：
https://code.samourai.io/whirlpool/Whirlpool/-/blob/whirlpool/README.md

https://docs.samourai.io/whirlpool/basic-concepts

https://docs.samourai.io/en/wallet/features/whirlpool
